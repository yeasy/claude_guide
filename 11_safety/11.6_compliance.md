# 11.6 企业级合规与审计

在企业环境中落地 LLM 应用，最大的阻碍往往不是技术，而是合规（Compliance）。

## 11.6.1 数据脱敏 (PII Redaction)

在将数据发送给 Claude API 之前，必须剥离任何可识别个人身份信息 (Personal Identifiable Information, PII)。

### 常见 PII 类型
*   手机号、身份证号、邮箱地址
*   银行卡号
*   具体的家庭住址

### 脱敏方案
1.  **正则替换**：在代码层使用正则表达式将敏感信息替换为 `[PHONE]`, `[ID_CARD]` 等占位符。
2.  **Microsoft Presidio**：使用开源工具 Microsoft Presidio 自动识别和脱敏文本中的实体。

## 11.6.2 审计日志 (Audit Logs)

为了满足 ISO 27001 或等保三级的要求，所有与 AI 的交互都必须留痕。

### 必记字段
设计数据库表结构时，建议包含以下字段：

| 字段名 | 描述 |
| :--- | :--- |
| `request_id` | 也就是 `x-request-id`，用于向 Anthropic 客服追溯问题 |
| `input_tokens` | 消耗的输入 Token 数 |
| `output_tokens` | 消耗的输出 Token 数 |
| `model_version` | 调用的具体模型版本（如 `claude-3-5-sonnet-20241022`） |
| `prompt_hash` | Prompt 的哈希值（用于检测 Prompt 变动） |
| `user_id` | 发起请求的内部用户 ID |
| `timestamp` | 精确到毫秒的时间戳 |

## 11.6.3 零留存设置 (Zero Retention)

对于极其敏感的金融或医疗场景，企业用户可以与 Anthropic 签署 BAA (Business Associate Agreement) 或申请开启“零留存 (Zero Retention)”模式。
在此模式下，Anthropic 承诺不会将你的数据写入其磁盘日志，仅在内存中处理完毕后即刻销毁，从而彻底消除数据泄露隐患。
