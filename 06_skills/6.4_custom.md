## 6.4 创建自定义 Skills

当内置技能无法满足你的特定需求时，就是发挥创造力的时候了。
创建一个自定义 Skill 就像是为 Claude 编写一个“性格插件”。

本节将介绍如何构建一个 **"Enterprise Code Reviewer" (企业级代码审查)** Skill。

### 6.4.1 准备工作

在 Claude Code (CLI) 或支持 Skills 的平台中，创建一个新的 Skill 目录。

```bash
mkdir -p ~/.claude/skills/enterprise-reviewer
cd ~/.claude/skills/enterprise-reviewer
```

### 6.4.2 步骤一：编写 Manifest (`manifest.json`)

这是 Skill 的元数据，告诉 Router 什么时候该召唤它。

```json
{
  "name": "enterprise-code-reviewer",
  "version": "1.0.0",
  "description": "Reviews code based on Acme Corp's strict security and style guidelines.",
  "triggers": [
    "review code",
    "check pr",
    "security audit",
    "code quality"
  ],
  "dependencies": ["mcp-server-git"]
}
```

### 6.4.3 步骤二：定义 System Prompt (`skill.md`)

这是最关键的部分。需要将模糊的“经验”转化为明确的“指令”。

```markdown
# Role
You are a Senior Code Reviewer at Acme Corp. You are known for being strict about security but helpful with explanations.

# Knowledge Base
You have deep knowledge of:
- OWASP Top 10 vulnerabilities.
- Acme Corp's internal "Titan Framework".
- Google Java Style Guide.

# Review Rules
1. **No Secrets**: Check for any hardcoded API keys or passwords. This is a blocker.
2. **SQL Injection**: Ensure all DB queries use `TitanDB.queryParams()`. Raw string concatenation is forbidden.
3. **Log Sanitization**: Ensure no PII (e.g., email, phone) is logged.
4. **Naming**: Variables must use `camelCase`. Constants must use `UPPER_SNAKE_CASE`.

# Output Format
Please format your review as a markdown table:

| File | Line | Severity | Issue | Suggestion |
|------|------|----------|-------|------------|
| ...  | ...  | Critical | ...   | ...        |

After the table, provide a summary and a "Pass/Block" decision.
```

### 6.4.4 步骤三：添加领域知识 (`docs/`)

如果规则太复杂，写在 Prompt 里会浪费 Token。更好的做法是放进文档。
创建一个 `docs/acme_security_guidelines.md`：

```markdown
# Acme Corp Security Guidelines v2.0

## 1. Authentication
All endpoints must be annotated with `@TitanAuth`.
...

## 2. Data Encryption
All user data at rest must be encrypted using AES-256...
...
```
当 Claude 加载此 Skill 时，它会自动索引这些文档。如果它不确定某行代码是否合规，它会去查阅这份文档。

### 6.4.5 步骤四：配置 Few-Shot 示例 (`examples/`)

让 Claude 看看什么是“完美的审查意见”。

`examples/review_example_1.json`:
```json
{
  "input": "User uploaded a Java file with raw SQL query.",
  "output": "| File | Line | Severity | Issue | Suggestion |\n|---|---|---|---|---|\n| UserService.java | 45 | Critical | SQL Injection Risk | Use `stmt.setObject()` instead of string concatenation. |\n\n**Decision**: BLOCK"
}
```

### 6.4.6 步骤五：注册与测试

#### 注册
如果使用的是 Claude Code，通常只需将目录放到指定位置即可自动加载。
如果使用的是 API，需要将上述 JSON 结构作为参数传递给 `skills` 字段。

#### 测试回环
不要假设它一次就能工作完美。
1.  **测试用例 A**: 给它一段完美的代码。 --> 期望：通过。
2.  **测试用例 B**: 给它一段包含硬编码密码的代码。 --> 期望：拦截，并准确指出行号。
3.  **测试用例 C**: 给它一段使用了旧框架的代码。 --> 期望：建议迁移到 Titan 框架。

### 6.4.7 高级技巧：自带工具

你的 Skill 还可以包含 Python 脚本。
比如，有一个内部工具 `linter_cli`，可以封装一个 MCP Tool 给这个 Skill。

```python
# tools/run_linter.py
@tool
def run_acme_linter(file_path: str) -> str:
    """Run the official Acme Corp static analysis tool."""
    return subprocess.check_output(["/usr/bin/acme-lint", file_path])
```

在 `skill.md` 中添加：
> "Before manual review, always run the `run_acme_linter` tool first to catch syntax errors."

这样，Claude 在开口说话之前，会先在后台运行一遍代码检查工具，从而提供极其精准的反馈。

---

现在，已经掌握了创建单一 Skill 的能力。但在真实世界中，复杂任务往往需要多个专家协作——比如一个负责写代码，一个负责写文档，一个负责做测试。这就涉及到了 **Skill Orchestration (技能编排)**。

➡️ [Skills 组合与高级用法](6.5_combination.md)
