# 2.7 提示词优化与调试

当 Claude 的输出不符合预期时，如何系统性地诊断和解决问题？本节提供一个实用的调试框架。

---

## 常见问题与解决方案

### 问题 1：输出太冗长

**症状**：Claude 回复过于详细，重复啰嗦

**解决方案**：
```xml
<constraints>
- 回复控制在 200 字以内
- 不要重复问题
- 直接给出答案，无需铺垫
</constraints>
```

---

### 问题 2：输出格式不对

**症状**：期望 JSON，但输出包含其他文字

**解决方案**：
1. 使用预填充（Prefill）
2. 明确说明"只输出 JSON，不要其他内容"
3. 提供严格的格式示例

---

### 问题 3：幻觉/编造事实

**症状**：Claude 输出不存在的信息

**解决方案**：
```xml
<constraints>
- 如果不确定，请明确说"我不确定"
- 不要编造数据或引用
- 只根据提供的信息回答
</constraints>
```

---

### 问题 4：忽略部分指令

**症状**：Claude 只完成了部分任务

**解决方案**：
- 使用编号列表明确任务
- 使用 XML 标签分隔
- 在结尾加检查提示："请确保完成以上所有要求"

---

## 调试检查清单

| 检查项 | 问题 |
|--------|------|
| ✅ 指令是否清晰 | 模糊的指令导致模糊的输出 |
| ✅ 上下文是否充分 | 背景信息不足 |
| ✅ 格式是否指定 | 未指定格式导致不一致 |
| ✅ 示例是否提供 | 缺少示例时表现不稳定 |
| ✅ 约束是否合理 | 矛盾的约束导致困惑 |

---

## A/B 测试方法

对于重要的提示词，进行系统性测试：

1. **准备测试用例**：10-20 个代表性输入
2. **定义评分标准**：准确性、格式、风格
3. **对比不同版本**：修改一个变量
4. **统计结果**：选择表现更好的版本

---

## 迭代优化流程

```
初始提示词
    ↓
测试 → 发现问题
    ↓
分析原因
    ↓
修改提示词
    ↓
重新测试
    ↓
满意？ → 否 → 继续迭代
    ↓ 是
部署使用
```

---

## 小结

- 系统性诊断问题，而非随机修改
- 善用检查清单排查常见问题
- A/B 测试验证优化效果
- 提示工程是一个迭代过程

---

恭喜你完成第二章！你已经掌握了提示工程的核心技术。值得注意的是，不同模型因为训练数据的差异，对于同样提示词的输出可能是不一样的。因此针对不同模型，需要设计不同风格的提示词模板。

**[继续阅读：第三章 Tool Use 工具调用 →](../03_tools/README.md)**
