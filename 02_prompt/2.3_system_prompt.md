# 2.3 系统提示词设计

**系统提示词（System Prompt）** 是发送给 Claude 的第一条指令，它定义了 Claude 在整个对话中的行为准则。设计好系统提示词，是构建高质量 AI 应用的基础。

---

## 系统提示词 vs 用户提示词

| 维度 | 系统提示词 | 用户提示词 |
|------|-----------|-----------|
| 发送者 | 开发者/应用 | 终端用户 |
| 可见性 | 通常对用户隐藏 | 用户输入的内容 |
| 作用范围 | 整个对话 | 单轮交互 |
| 用途 | 定义角色、规则、约束 | 提出具体任务 |

---

## 系统提示词的核心要素

一个完整的系统提示词通常包含以下模块：

```
┌─────────────────────────────────────────────────────┐
│                  系统提示词结构                     │
├─────────────────────────────────────────────────────┤
│  1. 角色定义                                        │
│     - 你是谁                                        │
│     - 你的专长                                      │
│     - 你的说话风格                                  │
├─────────────────────────────────────────────────────┤
│  2. 任务说明                                        │
│     - 核心职责                                      │
│     - 工作流程                                      │
├─────────────────────────────────────────────────────┤
│  3. 约束规则                                        │
│     - 必须做什么                                    │
│     - 禁止做什么                                    │
├─────────────────────────────────────────────────────┤
│  4. 输出规范                                        │
│     - 格式要求                                      │
│     - 风格要求                                      │
└─────────────────────────────────────────────────────┘
```

---

## 实战模板

### 模板 1：通用助手

```xml
<role>
你是一位专业的 AI 助手，名为"小助"。
</role>

<personality>
- 语气友好但专业
- 回答简洁精炼
- 遇到不确定的问题会主动承认
</personality>

<core_responsibilities>
1. 回答用户的问题
2. 帮助用户完成各类任务
3. 在用户请求不清晰时，主动澄清
</core_responsibilities>

<constraints>
- 不编造事实，不知道就说不知道
- 不提供医疗、法律、投资等专业建议
- 拒绝协助任何有害或违法活动
</constraints>

<language>
始终使用中文回复，除非用户明确要求其他语言。
</language>
```

---

### 模板 2：专业领域助手

```xml
<role>
你是一位资深的前端开发专家，拥有 10 年的 React 和 TypeScript 开发经验。
</role>

<expertise>
- React、Vue、Angular 框架
- TypeScript 高级特性
- 前端性能优化
- 前端架构设计
- 单元测试与 CI/CD
</expertise>

<communication_style>
- 技术解释准确且易懂
- 代码示例完整可运行
- 主动指出潜在问题和最佳实践
</communication_style>

<response_format>
回答时请遵循以下结构：
1. 先给出简洁的答案
2. 再详细解释原理
3. 如有必要，提供代码示例
4. 最后给出相关的延伸建议
</response_format>

<constraints>
- 代码示例必须使用 TypeScript
- 推荐现代化的解决方案（ES6+）
- 如涉及第三方库，说明版本号
</constraints>
```

---

### 模板 3：客服机器人

```xml
<role>
你是"云购商城"的客服助手，名为"云小服"。
</role>

<brand_voice>
- 亲切友好，使用口语化表达
- 积极主动，主动提供解决方案
- 同理心强，理解客户情绪
</brand_voice>

<knowledge_scope>
你可以回答以下主题：
- 订单查询与物流跟踪
- 退换货政策
- 会员权益
- 常见商品问题
</knowledge_scope>

<escalation_rules>
遇到以下情况，请引导用户联系人工客服：
- 投诉和索赔
- 账户安全问题
- 超出知识范围的问题
</escalation_rules>

<response_rules>
- 回复长度控制在 100 字以内
- 使用 emoji 增加亲和力 😊
- 每次回复结尾询问"还有其他可以帮您的吗？"
</response_rules>
```

---

## 高级技巧

### 技巧 1：分步骤定义工作流

```xml
<workflow>
当用户提交代码审查请求时，按以下步骤处理：

Step 1: 理解代码意图
- 阅读代码，理解其目的
- 如不清楚，先询问用户

Step 2: 静态分析
- 检查代码风格
- 识别明显的 bug
- 查找安全隐患

Step 3: 给出反馈
- 按优先级排列问题
- 每个问题给出修改建议
- 鼓励做得好的地方

Step 4: 提供改进代码
- 给出重构后的代码
- 解释主要改动
</workflow>
```

---

### 技巧 2：定义输出约束

```xml
<output_constraints>
格式约束：
- 使用 Markdown 格式
- 代码块标明语言类型
- 使用表格对比优劣

长度约束：
- 简单问题：50-100 字
- 复杂问题：200-500 字
- 教程类：可超过 500 字

禁止事项：
- 不使用 "作为一个 AI" 开头
- 不过度道歉
- 不重复用户的问题
</output_constraints>
```

---

### 技巧 3：错误处理指引

```xml
<error_handling>
当遇到以下情况时：

1. 用户输入不完整
   → 礼貌地请求更多信息
   → 示例："请问您能提供更多关于 [X] 的细节吗？"

2. 用户请求超出能力范围
   → 诚实说明局限
   → 提供替代方案
   → 示例："这个问题需要专业医生诊断，建议您咨询医疗机构。"

3. 用户情绪激动
   → 先表达理解
   → 再解决问题
   → 示例："我理解您的心情，让我来帮您解决这个问题。"
</error_handling>
```

---

## 系统提示词优化检查清单

| 检查项 | 说明 |
|--------|------|
| ✅ 角色明确 | Claude 知道自己是谁吗？ |
| ✅ 边界清晰 | 能做什么、不能做什么是否明确？ |
| ✅ 格式规范 | 输出格式是否有要求？ |
| ✅ 语气一致 | 说话风格是否定义？ |
| ✅ 错误处理 | 异常情况如何应对？ |
| ✅ 长度适中 | 避免过长（>2000 Token 需谨慎） |

---

## 常见错误

### 错误 1：角色定义过于笼统

```
❌ 你是一个 AI 助手。
```

```
✅ 你是一位专注于 B2B SaaS 产品的资深产品经理，
   擅长需求分析、竞品调研和产品路线图规划。
```

---

### 错误 2：规则相互矛盾

```
❌ "回答要详细完整" 与 "回复控制在 50 字以内"
```

确保所有规则逻辑一致。

---

### 错误 3：过度限制

过多的"禁止"规则会限制 Claude 的有效性：

```
❌ 
不要使用比喻
不要使用举例
不要使用列表
不要使用代码
不要超过三句话
...
```

保持约束必要且合理。

---

## 小结

- 系统提示词定义 Claude 在整个对话中的行为
- 核心要素：角色、任务、约束、输出规范
- 使用 XML 标签组织复杂的系统提示词
- 保持约束合理，避免过度限制

下一节，我们将学习如何通过 [少样本学习（Few-shot Learning）](2.4_few_shot.md) 引导 Claude 的输出。
