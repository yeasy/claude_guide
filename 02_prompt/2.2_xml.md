# 2.2 使用 XML 标签结构化指令

当提示词变得复杂时，纯文本描述容易混乱。Claude （以及大部分的大语言模型）被专门训练来识别和理解 **XML 标签**，这是组织复杂提示词的利器。

---

## 为什么使用 XML 标签？

| 优势 | 说明 |
|------|------|
| **视觉清晰** | 一眼就能看出提示词的结构 |
| **语义明确** | 标签名称说明了内容的用途 |
| **便于解析** | Claude 能准确区分指令、数据、示例 |
| **易于维护** | 修改某个部分不会影响其他部分 |

---

## 常用 XML 标签

以下是推荐使用的标签及其用途：

| 标签 | 用途 | 示例 |
|------|------|------|
| `<instructions>` | 核心指令 | 任务描述、步骤 |
| `<context>` | 背景信息 | 项目情况、用户信息 |
| `<example>` | 单个示例 | 输入输出对 |
| `<examples>` | 多个示例容器 | 包含多个 `<example>` |
| `<input>` | 待处理的输入 | 用户数据、文本 |
| `<output>` | 期望的输出 | 示例中的输出 |
| `<constraints>` | 约束条件 | 长度、格式限制 |
| `<format>` | 输出格式说明 | JSON、Markdown 等 |
| `<thinking>` | 思考过程 | 引导 Claude 展示推理 |

---

## 基础用法：分离指令与数据

### 无标签（混乱）

```
请翻译以下内容为英文：今天天气真好，我们去公园散步吧。翻译时注意保持口语化风格。
```

问题：哪里是指令？哪里是数据？

### 有标签（清晰）

```xml
<instructions>
请将以下中文翻译为英文，保持口语化风格。
</instructions>

<input>
今天天气真好，我们去公园散步吧。
</input>
```

---

## 进阶用法：多层嵌套

对于复杂任务，可以使用嵌套标签：

```xml
<task>
你是一个代码审查助手，请审查以下代码并提供反馈。
</task>

<code language="python">
def calculate_total(items):
    total = 0
    for item in items:
        total = total + item['price'] * item['qty']
    return total
</code>

<review_criteria>
  <criterion name="可读性">
    检查变量命名、代码格式、注释
  </criterion>
  <criterion name="性能">
    检查循环效率、冗余计算
  </criterion>
  <criterion name="健壮性">
    检查边界条件、错误处理
  </criterion>
</review_criteria>

<output_format>
请按以下格式输出：
## 可读性
[反馈内容]

## 性能
[反馈内容]

## 健壮性
[反馈内容]

## 改进后代码
[优化后的完整代码]
</output_format>
```

---

## 示例标签的最佳实践

提供示例时，使用 `<examples>` 和 `<example>` 标签：

```xml
<instructions>
将用户输入转换为结构化的日程数据。
</instructions>

<examples>
  <example>
    <input>明天下午3点和李明开会讨论项目</input>
    <output>
    {
      "datetime": "明天 15:00",
      "type": "会议",
      "participants": ["李明"],
      "topic": "讨论项目"
    }
    </output>
  </example>

  <example>
    <input>周五上午提交月度报告</input>
    <output>
    {
      "datetime": "周五 上午",
      "type": "任务",
      "participants": [],
      "topic": "提交月度报告"
    }
    </output>
  </example>
</examples>

<user_input>
下周一早上9点半参加部门培训
</user_input>
```

---

## 处理长文档

当输入内容很长时，使用标签帮助 Claude 定位重要部分：

```xml
<instructions>
请阅读以下合同文档，回答用户的问题。
如果问题的答案在文档中找不到，请明确说明。
</instructions>

<document title="服务合同" pages="15">
[此处是长达数千字的合同文本]
</document>

<user_question>
这份合同的有效期是多久？提前终止需要支付违约金吗？
</user_question>

<answer_format>
请分点回答，每个问题单独一段。引用合同原文时使用引号。
</answer_format>
```

**技巧**：对于长文档（如超过 20,000 Token），将问题放在文档后面，Claude 会给予更多注意力。

---

## 自定义标签

你可以创建任何有意义的标签名：

```xml
<persona>
你是一位经验丰富的投资顾问，专注于指数基金投资。
说话风格专业但平易近人，会用类比解释复杂概念。
</persona>

<client_profile>
- 年龄：35岁
- 风险偏好：中等
- 投资经验：初级
- 投资目标：子女教育基金（15年后）
</client_profile>

<client_question>
我应该选择主动基金还是指数基金？
</client_question>
```

---

## 标签使用规则

| 规则 | 说明 |
|------|------|
| 标签名使用英文 | `<instructions>` 优于 `<指令>` |
| 驼峰或下划线命名 | `<user_input>` 或 `<userInput>` |
| 正确闭合标签 | 每个 `<tag>` 必须有对应的 `</tag>` |
| 标签名说明内容用途 | 让人一眼就知道这是什么 |
| 合理分层 | 避免过度嵌套（通常不超过 3 层） |

---

## 常见错误

### 错误 1：标签不闭合

```xml
❌ <instructions>
请翻译以下内容
<input>你好世界</input>
```

```xml
✅ <instructions>
请翻译以下内容
</instructions>
<input>你好世界</input>
```

### 错误 2：标签名不一致

```xml
❌ <Input>数据</input>
```

```xml
✅ <input>数据</input>
```

### 错误 3：滥用标签

```xml
❌ <a><b><c><d><e>内容</e></d></c></b></a>
```

只在需要区分时使用标签，不要为了用而用。

---

## 练习

将以下混乱的提示词重构为使用 XML 标签的版本：

**原始提示词**：
```
我需要你帮我分析一段客户反馈，这是一家咖啡店的评价。
客户说：咖啡很香但是等待时间太长了，服务员态度还行。
请提取出正面和负面的点，然后给出改进建议。
输出用 JSON 格式。
```

**重构后**（参考答案）：
```xml
<instructions>
分析以下客户反馈，提取正面和负面评价，并给出改进建议。
</instructions>

<context>
业务类型：咖啡店
</context>

<customer_feedback>
咖啡很香但是等待时间太长了，服务员态度还行。
</customer_feedback>

<output_format>
{
  "positive": ["..."],
  "negative": ["..."],
  "suggestions": ["..."]
}
</output_format>
```

---

## 小结

- XML 标签是组织复杂提示词的最佳工具
- 使用语义化的标签名称
- 合理分层，避免过度嵌套
- 对于长文档，将问题放在文档之后

下一节，我们将学习如何 [设计高效的系统提示词](2.3_system_prompt.md)。
