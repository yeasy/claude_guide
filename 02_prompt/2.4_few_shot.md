# 2.4 少样本学习与示例设计

**少样本学习（Few-shot Learning）** 是提示工程中最强大的技术之一。通过提供几个高质量的示例，你可以显著提升 Claude 的输出质量和一致性。

---

## 什么是少样本学习？

| 术语 | 含义 |
|------|------|
| Zero-shot | 不提供示例，直接给出任务 |
| One-shot | 提供 1 个示例 |
| Few-shot | 提供 2-5 个示例 |

**原理**：Claude 通过分析示例中的模式，理解你期望的输入-输出映射关系。

---

## 为什么少样本学习有效？

```
┌─────────────────────────────────────────────────────┐
│         少样本学习的作用                             │
├─────────────────────────────────────────────────────┤
│                                                     │
│  1. 格式示范                                        │
│     → Claude 学会使用你期望的输出格式               │
│                                                     │
│  2. 风格引导                                        │
│     → Claude 模仿示例中的语言风格                   │
│                                                     │
│  3. 边界演示                                        │
│     → 通过示例暗示处理边缘情况的方式                │
│                                                     │
│  4. 质量标杆                                        │
│     → 示例的质量决定了输出的质量                    │
│                                                     │
└─────────────────────────────────────────────────────┘
```

---

## 基础示例：格式引导

### Zero-shot（无示例）

```
请将以下句子标注情感：
"这家餐厅的服务太差了，再也不来了。"
```

**可能输出**：
```
这句话表达了负面情感，用户对餐厅的服务感到不满...（冗长的分析）
```

---

### Few-shot（有示例）

```xml
<task>
分析以下句子的情感，输出格式为：[情感: 正面/负面/中性]
</task>

<examples>
  <example>
    <input>今天天气真好，心情特别棒！</input>
    <output>[情感: 正面]</output>
  </example>
  
  <example>
    <input>这本书一般般吧，没什么特别的。</input>
    <output>[情感: 中性]</output>
  </example>
  
  <example>
    <input>等了两个小时还没修好，太耽误时间了。</input>
    <output>[情感: 负面]</output>
  </example>
</examples>

<user_input>
这家餐厅的服务太差了，再也不来了。
</user_input>
```

**输出**：
```
[情感: 负面]
```

---

## 示例设计原则

### 原则 1：示例质量决定输出质量

```
❌ 低质量示例
<example>
  <input>写邮件</input>
  <output>好的邮件</output>
</example>
```

```
✅ 高质量示例
<example>
  <input>给客户写一封关于项目延期的道歉邮件</input>
  <output>
  尊敬的王经理：

  关于XX项目的交付时间，我们需要向您说明一个重要情况。

  由于供应链问题导致核心组件延迟到货，原定于1月15日的交付日期
  需要推迟至1月25日。对此给您带来的不便，我们深表歉意。

  为了弥补这一延误，我们将：
  1. 提供5%的项目费用折扣
  2. 增派人手确保后续进度
  3. 每周提供详细进度报告

  如有任何问题，请随时与我联系。

  此致敬礼
  [签名]
  </output>
</example>
```

---

### 原则 2：覆盖多样化场景

示例应该覆盖不同的情况：

```xml
<examples>
  <!-- 示例 1：典型情况 -->
  <example>
    <input>2024-03-15</input>
    <output>2024年3月15日（周五）</output>
  </example>
  
  <!-- 示例 2：年份省略 -->
  <example>
    <input>03-15</input>
    <output>2024年3月15日（周五）【假设当前年份】</output>
  </example>
  
  <!-- 示例 3：自然语言输入 -->
  <example>
    <input>下周一</input>
    <output>2024年3月18日（周一）</output>
  </example>
  
  <!-- 示例 4：边缘情况 -->
  <example>
    <input>无效日期</input>
    <output>[错误] 无法解析日期，请使用 YYYY-MM-DD 格式</output>
  </example>
</examples>
```

---

### 原则 3：保持示例数量适中

| 示例数量 | 适用场景 |
|---------|---------|
| 1-2 个 | 简单任务，格式清晰 |
| 3-5 个 | 中等复杂度，需要覆盖变体 |
| 5-10 个 | 复杂任务，需要处理多种边缘情况 |

**注意**：示例过多会增加 Token 消耗和处理时间。

---

### 原则 4：展示思考过程（可选）

对于推理任务，可以在示例中展示思考过程：

```xml
<example>
  <input>
  一家商店有 50 个苹果，上午卖掉了 18 个，
  下午又进货了 25 个，请问现在有多少苹果？
  </input>
  <output>
  思考过程：
  1. 初始数量：50 个
  2. 上午卖掉：50 - 18 = 32 个
  3. 下午进货：32 + 25 = 57 个
  
  答案：现在有 57 个苹果。
  </output>
</example>
```

---

## 高级技巧：负面示例

有时候，展示"不要怎么做"也很有帮助：

```xml
<examples>
  <good_example>
    <input>帮我总结这篇文章</input>
    <output>
    本文主要讨论了三个核心观点：
    1. [观点一]
    2. [观点二]  
    3. [观点三]
    结论是...
    </output>
  </good_example>
  
  <bad_example reason="避免这种输出">
    <input>帮我总结这篇文章</input>
    <output>
    好的，我来帮您总结。这篇文章非常有趣，作者在开头提到...
    （过于冗长且未切入重点）
    </output>
  </bad_example>
</examples>
```

---

## 动态示例选择

在构建 AI 应用时，可以根据用户输入动态选择相关示例：

```python
# 示例库
examples = {
    "email": [示例1, 示例2],
    "code": [示例3, 示例4],
    "analysis": [示例5, 示例6],
}

def get_relevant_examples(user_intent):
    """根据用户意图选择相关示例"""
    # 使用分类器或关键词匹配确定意图
    intent = classify_intent(user_input)
    return examples.get(intent, [])

# 动态构建提示词
selected_examples = get_relevant_examples(user_input)
prompt = build_prompt_with_examples(task, selected_examples, user_input)
```

---

## 检查清单

设计示例时，确保：

- [ ] 示例格式与期望输出完全一致
- [ ] 示例覆盖了主要场景类型
- [ ] 示例质量代表了期望的输出水平
- [ ] 边缘情况有对应示例
- [ ] 示例数量适中（通常 3-5 个）

---

## 练习

为以下任务设计 3 个 Few-shot 示例：

**任务**：将非正式的会议笔记转换为正式的会议纪要

**参考答案**：
```xml
<examples>
  <example>
    <input>
    张三说预算超了，李四觉得可以砍掉A功能，最后决定再讨论
    </input>
    <output>
    **议题**：项目预算超支问题
    **讨论内容**：张三提出当前预算已超出计划。李四建议删减A功能以控制成本。
    **决议**：暂未达成共识，将在下次会议继续讨论。
    </output>
  </example>
  
  <example>
    <input>
    确定了用React做前端，下周五之前要出原型
    </input>
    <output>
    **议题**：技术方案与时间节点
    **讨论内容**：团队确认采用 React 作为前端框架。
    **决议**：原型需在下周五（[具体日期]）前完成。
    **负责人**：[待指定]
    </output>
  </example>
  
  <example>
    <input>
    王总同意了，预算追加20万
    </input>
    <output>
    **议题**：预算追加审批
    **讨论内容**：就预算追加事项向王总汇报。
    **决议**：王总批准追加预算 20 万元。
    **后续行动**：财务部门办理预算变更手续。
    </output>
  </example>
</examples>
```

---

## 小结

- Few-shot 学习通过示例教会 Claude 输出模式
- 示例质量直接决定输出质量
- 3-5 个多样化示例通常是最佳平衡点
- 边缘情况的示例尤为重要

下一节，我们将学习如何 [引导 Claude 进行逐步推理](2.5_cot.md)。
