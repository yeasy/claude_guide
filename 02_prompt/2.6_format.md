# 2.6 输出格式控制

精确控制 Claude 的输出格式，是构建可靠 AI 应用的关键。本节介绍各种格式控制技术。

---

## 常见输出格式

| 格式 | 用途 | 示例场景 |
|------|------|---------|
| JSON | 程序解析 | API 响应、数据提取 |
| Markdown | 文档呈现 | 报告、说明文档 |
| 纯文本 | 简单输出 | 聊天回复 |
| XML | 结构化数据 | 配置文件 |
| 表格 | 对比信息 | 功能对比、数据汇总 |

---

## JSON 格式输出

### 基础用法

```xml
<instructions>
分析以下评论的情感，以 JSON 格式输出。
</instructions>

<format>
{
  "sentiment": "positive|negative|neutral",
  "confidence": 0.0-1.0,
  "keywords": ["关键词1", "关键词2"]
}
</format>

<input>
这家店的咖啡太棒了，下次还来！
</input>
```

### 预填充技巧（Prefill）

通过预填充响应开头，强制 JSON 输出：

```python
# API 调用时预填充 Assistant 消息
messages = [
    {"role": "user", "content": "分析情感..."},
    {"role": "assistant", "content": "{"}  # 预填充
]
```

Claude 会从 `{` 继续，确保输出有效 JSON。

---

## Markdown 格式输出

```xml
<format>
请使用以下 Markdown 结构：

## 摘要
[一句话总结]

## 要点
- 要点 1
- 要点 2
- 要点 3

## 详细分析
[详细内容]

## 建议
1. 建议一
2. 建议二
</format>
```

---

## 表格格式

```xml
<format>
请用 Markdown 表格呈现对比结果：

| 维度 | 方案 A | 方案 B | 方案 C |
|------|--------|--------|--------|
| 成本 | ...    | ...    | ...    |
| 性能 | ...    | ...    | ...    |
| 难度 | ...    | ...    | ...    |
</format>
```

---

## 长度控制

| 指令 | 效果 |
|------|------|
| 一句话回答 | 约 20-50 字 |
| 100 字以内 | 简洁回复 |
| 500 字左右 | 详细但不冗长 |
| 不超过 3 段 | 按段落控制 |

示例：
```
请用一句话总结这篇文章的核心观点。
```

---

## 风格控制

```xml
<style>
语气：专业正式
人称：第三人称
禁止：口语化表达、emoji
必须：使用书面语
</style>
```

---

## 小结

- JSON 格式便于程序解析，配合预填充确保有效性
- Markdown 格式适合文档呈现
- 明确指定长度和风格约束

下一节是本章最后一节：[调试与优化提示词](2.7_optimization.md)。
