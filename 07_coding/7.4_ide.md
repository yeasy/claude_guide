## 7.4 IDE 集成与工作流

虽然 CLI 很酷，但 IDE 的功能更强大。
将 Claude 深度集成到 VS Code、JetBrains 或专门的 AI IDE（如 Cursor）中，可以获得最流畅的心流体验。

### 7.4.1 Cursor: AI Native IDE 的标杆

Cursor 是目前与 Claude 结合最紧密的 IDE。它默认支持 Claude 4.5 Sonnet，并围绕它构建了许多原生体验。

![Cursor IDE Interface](_images/cursor_interface.png)

#### Composer
这是 Cursor 的杀手级功能。按下 `Cmd+I` (或 `Ctrl+I`)，可以唤起 Composer 窗口。
*   **功能**: 可以说“把这三个页面的配色方案从亮色改为暗色”。
*   **Agentic**: Cursor 会同时打开这三个文件，并行进行 Diff 编辑。只需要最后点一下 "Accept All"。

#### Context 自动索引
Cursor 会自动为你的整个代码库建立 Embeddings 索引。
*   **Chat**: 当问“这里的鉴权逻辑是在哪定义的？”时，Cursor 会自动检索相关的代码片段喂给 Claude，无需手动打开文件。
*   **Documentation**: 可以添加外部文档链接（如 React 官方文档），Cursor 会抓取并索引，让 Claude 基于最新文档回答问题。

### 7.4.2 VS Code + Continue/Cline

如果不想换 IDE，可以使用开源插件。

#### Cline
Cline 是一个基于 MCP 理念的 VS Code 插件，专为 Agentic Coding 设计。
*   **Visual Evolution**: 它会展示每一歩的操作（读取文件 -> 思考 -> 修改文件 -> 运行命令）。
*   **Human-in-the-Loop**: 每一次文件写入和命令执行，都需要用户点击批准（也可以设置自动批准）。
*   **Token 监控**: 实时显示当前任务消耗了多少 Token 和金额。

#### Continue
Continue 是一个开源的 AI 编程助手扩展。
*   **多模型切换**: 可以在 Claude 4.5 Sonnet 和 DeepSeek Coder 之间随意切换。
*   **自定义 Context Providers**: 支持从 Jira、GitHub Issues 拉取上下文。

### 7.4.3 工作流最佳实践

有了这些工具，开发工作流发生了什么变化？

#### TDD 2.0
1.  **Human**: 在 IDE 中创建一个空的测试文件 `test_user_service.py`，写下测试函数名和注释（描述预期行为）。
2.  **Claude (Cursor/Cline)**: "看到这个测试文件了吗？请实现它，并编写通过这些测试所需的实现代码。"
3.  **Claude**: 自动生成测试代码 body，自动创建 `user_service.py`，自动运行测试。
4.  **Human**: 看着绿色的测试通过图标，提交代码。

#### 遗留代码考古
面对一个没有任何注释的 5000 行 `Utils.java`。
1.  **Human**: 选中代码，`Cmd+L` (Chat)。
2.  **Prompt**: "请解释这段代码的逻辑，并为每个公共方法生成 Javadoc。"
3.  **Claude**: 生成解释和注释。
4.  **Human**: "Apply to file"。瞬间代码变得可读了。

#### 结对编程
不要把 Claude 当作搜索引擎，把它当作坐在旁边的同事。
*   **Human**: "我觉得这个函数的复杂度太高了，有没有办法优化一下？"
*   **Claude**: "我们可以把这部分逻辑提取出来，用策略模式重构..."
*   **Human**: "好主意，但这会不会影响性能？"
*   **Claude**: "我们可以做个基准测试..."

### 7.4.4 提示词工程在 IDE 中的应用

在 IDE 中，Context 是隐式的。需要学会管理这些 Context，最有效的手段是**显式化项目知识**。

#### 1. `@Files` 引用
显式引用文件比让 AI 猜更准。在 Cursor 或 Cline 中输入 `@` 可以引用文件、文件夹甚至 Git Diff，确保 AI 聚焦于相关代码，而不是产生幻觉。

#### 2. `.cursorrules`
这是 Cursor IDE 特有的机制（其他工具也有类似配置文件）。可以在项目根目录放一个 `.cursorrules` 文件。这主要用于**约束 AI 的行为**。
> "在这个项目中，我们使用 Tailwind CSS。不要使用传统的 CSS 模块。总是优先使用 flexbox。"

#### 3. `CLAUDE.md`
这是一个在社区中非常流行的最佳实践（有时也叫 `AI.md` 或 `CONTEXT.md`）。
它不是给人类看的 `README.md`，而是**专门给 AI 看的项目说明书**。

**为什么需要它？**
User 每次开始新会话时，Claude 并不记得项目之前的架构决策、隐含的业务逻辑或特定的构建命令。`CLAUDE.md` 就像是项目的“长期记忆”外挂。

**标准模板示例 (`CLAUDE.md`)**：

```markdown
# Project Context for Claude

## Commands
- Run Server: `npm run dev`
- Run Tests: `npm test`
- Build: `npm run build`
- Database: `npx prisma studio`

## Architecture
- Frontend: React + Vite + Tailwind
- Backend: NestJS (Microservices)
- Data: PostgreSQL + Prisma
- Auth: JWT in http-only cookie

## Coding Standards
1. **Functional Only**: No Class components in React.
2. **Error Handling**: Always use try-catch in async server controllers.
3. **Naming**: Variables use camelCase, database columns use snake_case.

## Common Pitfalls
- When updating user profile, remember to invalidate the redis cache `user:${id}`.
- Do NOT modify `src/legacy/core.js` - it is frozen.
```

**使用技巧**:
*   在 CLI 工具（如 `anthropic-quickstarts` 中的脚本）中，可以配置自动读取此文件。
*   在 IDE 对话开始时，可以直接把这个文件 `@` 进去，让 AI "Read project context first"。

---

工具和环境都准备好了。理论结合实践，下一节将通过几个硬核的实战案例，看看 Agentic Coding 到底能解决多难的问题。

➡️ [自主编码实践与案例](7.5_practical.md)
