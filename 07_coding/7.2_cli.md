## 7.2 Claude Code CLI 入门

**Claude Code** (在早期版本或内部工具中常简称为 `claude` CLI) 是 Anthropic 推出的专为开发者设计的终端工具。
它不仅仅是一个 API 包装器，它是一个具有 **Agentic Capabilities (代理能力)** 的编程助手。它可以直接读取文件系统、运行终端命令、甚至自动提交 git commit。

### 7.2.1 为什么需要 CLI？

在网页端，通常需要手动复制文件内容粘贴给 Claude，然后再把 Claude 生成的代码复制回编辑器。
Claude Code CLI 解决了这个痛点：
1.  **直接读写**: 它能直接读取 `src/main.py`，并把修改写回去。
2.  **环境感知**: 它能运行 `ls`, `grep`, `git status` 来自己探索项目结构。
3.  **循环迭代**: 它能运行测试 -> 发现失败 -> 自动修复 -> 再运行测试，直到通过。

### 7.2.2 安装与配置

#### 安装
通常通过 npm 安装（假设已发布到 npm）：

```bash
npm install -g @anthropic-ai/claude-code
```

#### 认证
首次运行需要登录：
```bash
claude login
```
系统会弹窗引导完成 OAuth 授权，或提示输入 API Key。

#### 权限模式
为了安全，Claude Code 提供了不同的权限级别：
*   **Safe Mode (默认)**: 只能读取文件。任何写入操作或命令执行都需要用户按 `y` 确认。
*   **Auto Mode (`--auto`)**: 允许自动执行读取、写入和安全命令（如 `ls`）。危险命令（如 `rm`）仍需确认。

### 7.2.3 核心命令详解

#### 交互模式
直接运行 `claude` 进入对话模式。

```bash
$ claude
Welcome to Claude Code. Type /help for commands.

> 帮我分析一下当前目录的结构。
(Claude runs `ls -R`)
当前目录包含 src, tests 和 docs...

> 把 src/utils.py 里的日志库从 logging 换成 structlog。
(Claude reads src/utils.py)
(Claude edits src/utils.py)
已完成修改，是否查看 diff? (y/n)
```

#### 单次任务
适合快速处理的具体任务。

```bash
# 生成 commit message
claude commit

# 解释代码
claude "explain main.go"

# 快速重构
claude "fix strict null checks in data.ts"
```

#### 文件操作
Claude 支持 glob 模式匹配文件。

```bash
# 针对特定文件提问
claude "这些测试覆盖了哪些场景？" tests/*.py
```

### 7.2.4 独特的 Agent 能力

Claude Code 最强大的地方在于它内置了 **Tool Use** 循环。

#### 自动排错
以 Node.Js 项目为例，当输入：`claude "运行测试并修复所有 Bug"` 时，它会：
1.  运行 `npm test`。
2.  捕获 stderr 输出。
3.  分析错误原因。
4.  定位到具体的源代码文件。
5.  修改代码。
6.  再次运行 `npm test` 验证修复。
7.  如果还报错，重复上述步骤（直到达到最大迭代次数）。

#### 项目理解
当询问 "这个项目是做什么的？" 时，Claude 会自动：
1.  读取 `README.md`。
2.  读取 `package.json` 或 `requirements.txt` 分析依赖。
3.  遍历 `src` 目录结构。
4.  给出一个总结。

### 7.2.5 配置与自定义

可以通过 `~/.claude/config.json` 或项目根目录下的 `.clauderc` 进行配置。

```json
{
  "model": "claude-4-5-sonnet-20250929",
  "temperature": 0,
  "rules": [
    "Always use TypeScript",
    "Line length limit: 80 chars"
  ],
  "ignore": ["coverage/", "dist/"]
}
```
*   **rules**: 相当于永久的 System Prompt，用于强制执行代码规范。

---

CLI 工具非常适合个人开发者在本地终端使用。但若想构建一个自动化的 CI/CD 机器人，或者开发一个基于 Claude 的 IDE 插件，则需要更底层的 **[SDK](7.3_sdk.md)**。

➡️ [Claude Code SDK 集成](7.3_sdk.md)
